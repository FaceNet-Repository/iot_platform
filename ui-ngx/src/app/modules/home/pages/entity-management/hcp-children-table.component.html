<!--

    Copyright © 2016-2024 The Thingsboard Authors

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

        http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.

-->


<mat-toolbar [fxShow]="!assignMode" class="mat-mdc-table-toolbar">
  <div class="mat-toolbar-tools">
    <div class="statistic">
      <span>Danh sách thiết bị </span> <span class="badge neutral">{{totalItems}}</span> <span class="badge green">{{totalOnline}}</span> <span class="badge red">{{totalOffline}}</span>
    </div>
    <span fxFlex></span>
    <div>
      <button mat-icon-button
              matTooltip="Gán thiết bị"
              matTooltipPosition="above"
              (click)="toggleAssignMode()">
        <mat-icon>add_link</mat-icon>
      </button>
      <button mat-icon-button
              matTooltip="Xuất dữ liệu"
              matTooltipPosition="above"
              (click)="exportData()">
        <mat-icon>file_download</mat-icon>
      </button>
    </div>
  </div>
</mat-toolbar>
<mat-toolbar [fxShow]="assignMode" class="mat-mdc-table-toolbar">
  <div class="mat-toolbar-tools">
    <fn-device-select [excludingIds]="excludingIds" [(select)]="selectDeviceIds"/>
    <span fxFlex></span>
    <div>
      <button mat-icon-button
              matTooltip="Xác nhận gán"
              matTooltipPosition="above"
              (click)="confirmAssignment()">
        <mat-icon>check</mat-icon>
      </button>
      <button mat-icon-button
              matTooltip="Hủy bỏ gán"
              matTooltipPosition="above"
              (click)="cancelAssignment()">
        <mat-icon>close</mat-icon>
      </button>
    </div>
  </div>
</mat-toolbar>
<table mat-table [dataSource]="dataSource" matSort matSortDisableClear>

  <ng-container matColumnDef="createdAt">
    <mat-header-cell *matHeaderCellDef> Ngày thêm</mat-header-cell>
    <mat-cell *matCellDef="let element"
              style="text-wrap: nowrap"> {{ element.createdAt | date: "dd/MM/YYYY hh:mm:ss" }}
    </mat-cell>
  </ng-container>

  <ng-container matColumnDef="name">
    <mat-header-cell *matHeaderCellDef> Tên </mat-header-cell>
    <mat-cell *matCellDef="let element" style="min-width: 6rem"> {{ element.name }}</mat-cell>
  </ng-container>

  <ng-container matColumnDef="type">
    <mat-header-cell *matHeaderCellDef> Loại </mat-header-cell>
    <mat-cell *matCellDef="let element" style="min-width: 6rem"> {{ element.type }}</mat-cell>
  </ng-container>

  <ng-container matColumnDef="status">
    <mat-header-cell *matHeaderCellDef> Trạng thái</mat-header-cell>
    <mat-cell *matCellDef="let element">
      <div *ngIf="element.active === 'true'; else inactiveTemplate" class="badge green">
        {{ "device.active" | translate }}
      </div>
      <ng-template #inactiveTemplate>
        <div class="badge red">
          {{ "device.inactive" | translate }}
        </div>
      </ng-template>
    </mat-cell>
  </ng-container>

  <ng-container matColumnDef="id">
    <mat-header-cell *matHeaderCellDef> ID </mat-header-cell>
    <mat-cell *matCellDef="let element" style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 2rem">
      <span matTooltip="{{ element.id.id }}">{{ element.id.id }}</span>
    </mat-cell>
  </ng-container>

  <ng-container matColumnDef="firmwareVersion">
    <mat-header-cell *matHeaderCellDef> Firmware version </mat-header-cell>
    <mat-cell *matCellDef="let element" style="min-width: 6rem"> {{ element.firmwareVersion }}</mat-cell>
  </ng-container>

  <ng-container matColumnDef="actions" stickyEnd>
    <mat-header-cell *matHeaderCellDef> Thao tác </mat-header-cell>
    <mat-cell *matCellDef="let element">
      <div fxShow>
        <button mat-icon-button
                matTooltip="Sao chép ID"
                matTooltipPosition="above"
                (click)="copyToClipboard(element.id.id)">
          <mat-icon>content_copy</mat-icon>
        </button>
        <button mat-icon-button
                matTooltip="Bỏ gán thiết bị"
                matTooltipPosition="above"
                (click)="detachDevice(element.id)">
          <tb-icon>link_off</tb-icon>
        </button>
      </div>
    </mat-cell>
  </ng-container>

  <mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></mat-header-row>
  <mat-row *matRowDef="let entity; columns: displayedColumns;" (click)="onRowClick($event, entity)"></mat-row>
</table>

<mat-divider></mat-divider>
<mat-paginator
  [pageSizeOptions]="pageSizeOptions"
  [length]="totalItems"
  [disabled]="isLoading"
  showFirstLastButtons
  aria-label="Select page">
</mat-paginator>
